define("Defaults",[],function(){"use strict";var t={inputsByAction:{}},e=function(e,r){t.inputsByAction[e]=r};return e("yawLeft","RIGHT_STICK_X_NEG"),e("yawRight","RIGHT_STICK_X_POS"),e("pitchUp","RIGHT_STICK_Y_POS"),e("pitchDown","RIGHT_STICK_Y_NEG"),e("rollClockwise","LEFT_STICK_X_POS"),e("rollCounter","LEFT_STICK_X_NEG"),e("moveForward","RIGHT_TOP_SHOULDER"),e("moveBackward","LEFT_TOP_SHOULDER"),e("moveLeft","FACE_3"),e("moveRight","FACE_2"),e("moveUp","FACE_4"),e("moveDown","FACE_1"),t}),define("jade",[],function(){}),define("ui/UiTemplates",["jade"],function(t){return t&&void 0!==t.runtime&&(t=t.runtime),this.UiTemplates=this.UiTemplates||{},this.UiTemplates.AddPropDialog=function(t){var e=[];return e.push('<div class="modal-header"><h3>Add a prop</h3></div><div class="modal-body"><div class="row-fluid"><input type="text" ng-model="search.text" placeholder="Blank separated search words" class="span12"/></div><div class="row-fluid"><tabset class="span12"><tab heading="Ship"><div class="row-fluid"><select ng-model="search.selected" ng-options="prop as prop.propData.resourceUrl for prop in filteredShips" size="10" class="span12"></select></div></tab><tab heading="Planet"><div class="row-fluid"><select ng-model="search.selected" ng-options="prop as prop.propData.resourceUrl for prop in filteredPlanets" size="10" class="span12"></select></div></tab><tab heading="Scenery"><div class="row-fluid"><select ng-model="search.selected" ng-options="prop as prop.propData.resourceUrl for prop in filteredSceneries" size="10" class="span12"></select></div></tab></tabset></div></div><div class="modal-footer"><button ng-click="add(search.selected)" ng-disabled="!search.selected" class="btn btn-primary">Add</button><button ng-click="cancel()" class="btn">Cancel</button></div>'),e.join("")},this.UiTemplates.CreateSessionDialog=function(t){var e=[];return e.push('<div class="modal-header"><h3>Create a Session</h3><span>eve-kino v.{{version}}</span></div><div class="modal-body"><tabset><tab heading="Background"><div class="btn-group"><button type="button" ng-model="set.type" btn-radio="\'space\'" class="btn">Space</button><button type="button" ng-model="set.type" btn-radio="\'chromaKey\'" class="btn">Chroma Key</button></div><div class="row-fluid"><div ng-show="(set.type == \'space\')">Select a background:<div class="row-fluid"><select ng-model="set.selectedBackground" ng-options="bg as bg.resourceUrl for bg in backgrounds" size="5" class="span12"></select></div></div><div ng-show="(set.type == \'chromaKey\')">Pick a color (RGB values):<div data-color-input color="set.chromaKey.color" on-change="colorInputChanged()"></div></div></div></tab><tab heading="By File"><div data-file-input="file" on-change="readFile(file)">Choose File</div></tab><tab heading="Quality"><div ng-repeat="option in qualityOptions" class="row-fluid"><div class="span4">{{option.title}}</div><div class="span8 btn-group"><button type="button" ng-repeat="value in option.values" ng-model="selectedOptions[option.field]" btn-radio="value.id" class="btn">{{value.title}}</button></div></div><div class="row-fluid"><div class="span12">Some of these settings are dependent on machine or resources and might not be available.</div></div></tab></tabset></div><div class="modal-footer"><button ng-click="create(set.type)" ng-disabled="!canBeCreated()" class="btn btn-primary">Create</button></div>'),e.join("")},this.UiTemplates.SplashDialog=function(t){var e=[];return e.push('<div class="modal-header"><h3>{{ title }}</h3></div><div class="modal-body">{{ message }}</div>'),e.join("")},this.UiTemplates}),define("ui/SplashDialog",["ui/UiTemplates"],function(t){"use strict";var e="SplashDialogController",r=t.SplashDialog(),i=function(t,e,r){t.title=r.title,t.message=r.message},n=function(t){t.controller(e,["$scope","dialog","model",i])},o=function(t,i){var n={backdrop:!0,backdropFade:!1,backdropClick:!1,keyboard:!1,controller:e,template:r,resolve:{model:function(){return i}}};return t.dialog(n)},a={controller:i,template:r,register:n,getBuilder:o};return a}),define("version",[],function(){return"0.0.7"}),define("util/validators/SessionValidator",["lib/jski"],function(t){"use strict";var e=t.object({space:t.object({background:t.string()}).required("background")}).required("space"),r=t.object({chromaKey:t.object({color:t.array(t.number()).minItems(3).maxItems(3).additionalItems(!1)}).required("color")}).required("chromaKey"),i=t.array(t.object({})),n=t.object({propType:t.string()}).required("propType"),o=t.object({propData:n,script:i}).required("propData","script"),a=t.object({props:t.array(o).additionalItems(!1)}).required("props"),s=t.object({shotList:i}).required("shotList"),c=t.object({cameras:t.array(s).additionalItems(!1)}).required("cameras"),u=t.object({ver:t.number().minimum(0),session:t.object({set:t.anyOf(e,r)}).required("set"),stage:a,videography:c}).required("ver","session","stage","videography"),p=function(){};return p.prototype.isValid=function(t){var e=u.validate(t);return 0===e.length},p}),define("ui/CreateSessionDialog",["version","ui/UiTemplates","util/validators/SessionValidator"],function(t,e,r){"use strict";var i="CreateSessionDialogController",n=e.CreateSessionDialog(),o=function(e,i,n,o){var a=function(t){var e=null;return n.backgrounds.forEach(function(r){r.resourceUrl===t&&(e=r)}),e};e.version=t,e.backgrounds=n.backgrounds,e.qualityOptions=n.qualityOptions,e.selectedOptions={},n.qualityOptions.forEach(function(t){e.selectedOptions[t.field]=t.defaultValue}),e.set={type:"space",selectedBackground:n.backgrounds[0],chromaKey:{color:[0,1,0]}},e.canBeCreated=function(){var t=!1;return"space"===e.set.type?t=!!e.set.selectedBackground:"chromaKey"===e.set.type&&(t=!!e.set.chromaKey.color),t},e.create=function(t){var r={};r.space=function(t){return t.setQualityOptions(e.selectedOptions),t.createSpaceSet(e.set.selectedBackground,e.set.sessionData)},r.chromaKey=function(t){return t.setQualityOptions(e.selectedOptions),t.createChromaKeyedSet(e.set.chromaKey.color,e.set.sessionData)},i.close(r[t])},e.readFile=function(t){var i=o.readAsText(e,t,"utf-8");i.then(function(t){var i,n=new r,o=!1;try{i=JSON.parse(t),o=n.isValid(i)}catch(s){}o?(e.set.sessionData=i,i.session.set.space?(e.set.type="space",e.set.selectedBackground=a(i.session.set.space.background)):i.session.set.chromaKey&&(e.set.type="chromaKey",e.set.chromaKey.color=i.session.set.chromaKey.color)):console.log("!!!!! file not valid")})}},a=function(t){t.controller(i,["$scope","dialog","model","fileReader",o])},s=function(t,e){var r={backdrop:!0,backdropFade:!1,backdropClick:!1,keyboard:!1,controller:i,template:n,resolve:{model:function(){return e}}};return t.dialog(r)},c={controller:o,template:n,register:a,getBuilder:s};return c}),define("ui/AddPropDialog",["ui/UiTemplates"],function(t){"use strict";var e="AddPropDialogController",r=t.AddPropDialog(),i=function(t,e,r){var i=this;this.resourceLibrary=r.resLibrary,this.modelView=t,t.selected=null,t.search={text:"",selected:null},t.filteredShips=[],t.filteredPlanets=[],t.filteredScenery=[],t.$watch("search.text",function(t){i.updateFiltered(t)}),t.cancel=function(){var t=function(){};e.close(t)},t.add=function(t){var r=function(e){e.addProp(t)};e.close(r)},this.updateFiltered("")};i.prototype.updateFiltered=function(t){var e=this.modelView,r=e.filteredShips=[],i=e.filteredPlanets=[],n=e.filteredSceneries=[],o=t.toLowerCase().split(" "),a=function(t){var e=t.propData.resourceUrl.toLowerCase(),r=!0;return o.forEach(function(t){e.indexOf(t)<0&&(r=!1)}),r};this.resourceLibrary.forEachResource("ship",function(t){a(t)&&r.push(t)}),this.resourceLibrary.forEachResource("planet",function(t){a(t)&&i.push(t)}),this.resourceLibrary.forEachResource("scenery",function(t){a(t)&&n.push(t)})};var n=function(t){t.controller(e,["$scope","dialog","model",i])},o=function(t,i){var n={backdrop:!0,backdropFade:!1,backdropClick:!1,keyboard:!0,controller:e,template:r,resolve:{model:function(){return i}}};return t.dialog(n)},a={controller:i,template:r,register:n,getBuilder:o};return a}),define("ui/Dialogs",["ui/SplashDialog","ui/CreateSessionDialog","ui/AddPropDialog"],function(t,e,r){"use strict";var i={splashDialog:t,createSessionDialog:e,addPropDialog:r};return i}),define("util/GlHelper",["lib/gl-matrix"],function(t){"use strict";t.mat4.multiply3x3=t.mat4.multiplyVec3;var e=Math.PI/180,r={forward:-1,upward:-1,rightward:1},i={rollClockwise:-1,pitchUp:-1,yawRight:-1},n={forward:1,upward:1,rightward:-1},o={rollClockwise:1,pitchUp:1,yawRight:-1},a={VIEW_DIRECTION_FORWARD:r.forward,VIEW_DIRECTION_UP:r.upward,VIEW_DIRECTION_RIGHT:r.rightward,VIEW_ROTATION_ROLL_CLOCKWISE:i.rollClockwise,VIEW_ROTATION_PITCH_UP:i.pitchUp,VIEW_ROTATION_YAW_RIGHT:i.yawRight,VIEW_VECTOR_FORWARD:t.vec3.create([0,0,r.forward]),VIEW_VECTOR_UP:t.vec3.create([0,r.upward,0]),VIEW_VECTOR_RIGHT:t.vec3.create([r.rightward,0,0]),MODEL_DIRECTION_FORWARD:n.forward,MODEL_DIRECTION_UP:n.upward,MODEL_DIRECTION_RIGHT:n.rightward,MODEL_ROTATION_ROLL_CLOCKWISE:o.rollClockwise,MODEL_ROTATION_PITCH_UP:o.pitchUp,MODEL_ROTATION_YAW_RIGHT:o.yawRight,MODEL_VECTOR_FORWARD:t.vec3.create([0,0,n.forward]),MODEL_VECTOR_UP:t.vec3.create([0,n.upward,0]),MODEL_VECTOR_RIGHT:t.vec3.create([n.rightward,0,0]),degreeToRad:function(t){return t*e}};return a}),define("simulation/Actuator",[],function(){"use strict";var t=function(t,e){this.timeWatch=t,this.timeSpan=e,this.currentValue=0};return t.prototype.getCurrentValue=function(){return this.currentValue},t.prototype.moveTo=function(t){var e=this.timeWatch.getDelta(),r=e/this.timeSpan,i=Math.abs(this.currentValue-t);return i>r?this.currentValue+=t>=this.currentValue?r:-r:this.currentValue=t,this.currentValue},t}),define("simulation/SimulatedThruster",[],function(){"use strict";var t=function(t,e,r){this.actuator=t,this.maxSpeed=e,this.velocityTimeFunction=r};return t.prototype.getSpeed=function(t){var e=this.actuator.moveTo(t),r=this.velocityTimeFunction(e);return r*this.maxSpeed},t}),define("util/MathHelper",[],function(){"use strict";var t=function(t,e,r){var i={x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r};return i},e=function(e,r){var i,n=[];for(i=0;i<e.length-1;i++)n.push(t(e[i],e[i+1],r));return n},r=function(t,r){for(var i=t;i.length>1;)i=e(i,r);return i[0].y},i={bezierGetY:r};return i}),define("production/Animator",["lib/gl-matrix","util/GlHelper","simulation/Actuator","simulation/SimulatedThruster","util/MathHelper"],function(t,e,r,i,n){"use strict";var o=t.quat4.create(),a=t.vec3.create(),s={getFrameData:function(){return null}},c=function(r,i,n,a){t.quat4.fromAngleAxis(i*e.MODEL_ROTATION_ROLL_CLOCKWISE,e.MODEL_VECTOR_FORWARD,o),t.quat4.multiply(r,o,r),t.quat4.fromAngleAxis(n*e.MODEL_ROTATION_PITCH_UP,e.MODEL_VECTOR_RIGHT,o),t.quat4.multiply(r,o,r),t.quat4.fromAngleAxis(a*e.MODEL_ROTATION_YAW_RIGHT,e.MODEL_VECTOR_UP,o),t.quat4.multiply(r,o,r)},u=function(t,e){var r=this,i=function(t,e,i){r.agility[t]={maximum:e,time:i}},n=function(t,e){var r={x:t,y:e};return r},o=[n(0,0),n(.33,.25),n(.66,.75),n(1,1)],a=[n(0,0),n(.75,.25),n(1,1)];this.prop=t,this.script=s,this.commandChannel=null,this.lastState=null,this.timeWatch=e,this.agility={},this.thrusters={},i("forward",300,.5),i("navigation",100,.5),i("rotation",2,1),this.createThruster("moveForward","forward",o),["moveBackward","moveLeft","moveRight","moveUp","moveDown"].forEach(function(t){r.createThruster(t,"navigation",o)}),["rollClockwise","rollCounter","pitchUp","pitchDown","yawLeft","yawRight"].forEach(function(t){r.createThruster(t,"rotation",a)})};return u.prototype.createThruster=function(t,e,o){var a=this.agility[e],s=new r(this.timeWatch,a.time),c=function(t){return n.bezierGetY(o,t)},u=new i(s,a.maximum,c);this.thrusters[t]=u},u.prototype.setScript=function(t){this.script=t},u.prototype.getScript=function(){return this.script},u.prototype.getProp=function(){return this.prop},u.prototype.setCommandChannel=function(t){this.commandChannel=t},u.prototype.resetToRecording=function(){var t=this.prop.getStateData(this.lastState),e=this.script.getFrameData()||t;this.prop.setStateData(e)},u.prototype.update=function(){var t=this.prop.getStateData(this.lastState),e=this.prop.getStateData(),r=this.script.getFrameData()||e;e=this.commandChannel?this.updateByCommands(e,t,r):r,this.prop.setStateData(e),this.script.setFrameData(e),this.lastState=t},u.prototype.updateByCommands=function(r,i,n){var o=this.timeWatch.getDelta(),s=this.commandChannel.getCommands(),u=(this.thrusters.rollClockwise.getSpeed(s.rollClockwise)-this.thrusters.rollCounter.getSpeed(s.rollCounter))*o,p=(this.thrusters.pitchUp.getSpeed(s.pitchUp)-this.thrusters.pitchDown.getSpeed(s.pitchDown))*o,h=(this.thrusters.yawRight.getSpeed(s.yawRight)-this.thrusters.yawLeft.getSpeed(s.yawLeft))*o,l=(this.thrusters.moveUp.getSpeed(s.moveUp)-this.thrusters.moveDown.getSpeed(s.moveDown))*o,d=(this.thrusters.moveRight.getSpeed(s.moveRight)-this.thrusters.moveLeft.getSpeed(s.moveLeft))*o,f=(this.thrusters.moveForward.getSpeed(s.moveForward)-this.thrusters.moveBackward.getSpeed(s.moveBackward))*o;return c(r.rotation,u,p,h),a[0]=d*e.MODEL_DIRECTION_RIGHT,a[1]=l*e.MODEL_DIRECTION_UP,a[2]=f*e.MODEL_DIRECTION_FORWARD,t.quat4.multiplyVec3(r.rotation,a),r.position[0]+=a[0],r.position[1]+=a[1],r.position[2]+=a[2],r},u}),define("production/StageManager",["production/Animator"],function(t){"use strict";var e=function(t,e){this.stage=t,this.timeWatch=e,this.animators=[]};return e.prototype.encodeData=function(){var t={props:[]},e=this;return this.stage.forEachProp(function(r){var i=e.findAnimatorByProp(r),n=i&&i.getScript(),o={propData:r.propData,script:n?n.data:[]};t.props.push(o)}),t},e.prototype.updateStage=function(){this.animators.forEach(function(t){t.update()})},e.prototype.getAnimator=function(e){var r=this.findAnimatorByProp(e);return r||(r=new t(e,this.timeWatch),this.animators.push(r)),r},e.prototype.findAnimatorByProp=function(t){var e=null;return this.animators.forEach(function(r){r.getProp()===t&&(e=r)}),e},e}),define("controls/CommandChannel",[],function(){"use strict";var t=function(t,e,r,i){this.owner=t,this.id=e,this.type=r,this.actions=i,this.resetCommands()};return t.prototype.resetCommands=function(){var t=this;this.commands={},this.actions.forEach(function(e){t.commands[e]=0})},t.prototype.close=function(){this.owner.removeCommandChannel(this.id)},t.prototype.hasAction=function(t){return this.actions.indexOf(t)>=0},t.prototype.setCommandIntensity=function(t,e){this.commands[t]=e},t.prototype.getCommands=function(){return this.commands},t}),define("controls/InputChannel",[],function(){"use strict";var t=function(t,e,r){this.owner=t,this.id=e,this.type=r};return t.prototype.close=function(){this.owner.removeInputChannel(this.id)},t.prototype.setIntensity=function(t,e){this.owner.setInputIntensity(this.type,t,e)},t}),define("production/Director",["controls/CommandChannel","controls/InputChannel"],function(t,e){"use strict";var r=function(){this.bindings={},this.commandChannels={},this.inputChannels={},this.idCounter=0};return r.prototype.getNextId=function(){return""+this.idCounter++},r.prototype.getInputChannel=function(t){var r=this.getNextId(),i=new e(this,r,t);return this.inputChannels[r]=i,i},r.prototype.removeInputChannel=function(t){delete this.inputChannels[t]},r.prototype.getCommandChannel=function(e,r){var i=this.getNextId(),n=new t(this,i,e,r);return this.commandChannels[i]=n,n},r.prototype.removeCommandChannel=function(t){delete this.commandChannels[t]},r.prototype.getBindings=function(){return this.bindings},r.prototype.addBinding=function(t,e){this.bindings[t.actionName]=[e]},r.prototype.setInputIntensity=function(t,e,r){var i=this,n=function(t){var n=i.bindings[t];n&&n.forEach(function(n){e===n.inputName&&i.setActionIntensity(t,r)})};for(var o in this.bindings)n(o)},r.prototype.setActionIntensity=function(t,e){var r,i;for(r in this.commandChannels)i=this.commandChannels[r],i.hasAction(t)&&i.setCommandIntensity(t,e)},r}),define("production/CameraOperator",["lib/gl-matrix","util/GlHelper","simulation/Actuator","simulation/SimulatedThruster","util/MathHelper"],function(t,e,r,i,n){"use strict";var o=["pitchUp","pitchDown","rollClockwise","rollCounter","yawRight","yawLeft","moveUp","moveDown","moveForward","moveBackward","moveRight","moveLeft"],a=t.vec3.create(),s=function(){var r=t.quat4.create();return function(i,n,o,a){t.quat4.fromAngleAxis(n*e.VIEW_ROTATION_ROLL_CLOCKWISE,e.VIEW_VECTOR_FORWARD,r),t.quat4.multiply(r,i,i),t.quat4.fromAngleAxis(o*e.VIEW_ROTATION_PITCH_UP,e.VIEW_VECTOR_RIGHT,r),t.quat4.multiply(r,i,i),t.quat4.fromAngleAxis(a*e.VIEW_ROTATION_YAW_RIGHT,e.VIEW_VECTOR_UP,r),t.quat4.multiply(r,i,i)}}(),c=function(e,r){t.quat4.set(e,r),s(r,0,0,-Math.PI),t.quat4.inverse(r)},u=function(){var e=t.quat4.create();return function(r,i){return c(r,e),t.quat4.multiplyVec3(e,i),i}}(),p=function(t,e,r){var i=this,n=function(t,e,r){i.agility[t]={maximum:e,time:r}},o=function(t,e){var r={x:t,y:e};return r},a=[o(0,0),o(.33,.25),o(.66,.75),o(1,1)],s=[o(0,0),o(.75,.25),o(1,1)];this.camera=t,this.shotList=e,this.commandChannel=null,this.timeWatch=r,this.agility={},this.thrusters={},n("forward",300,.5),n("navigation",100,.5),n("rotation",2,.5),this.createThruster("moveForward","forward",a),["moveBackward","moveLeft","moveRight","moveUp","moveDown"].forEach(function(t){i.createThruster(t,"navigation",a)}),["rollClockwise","rollCounter","pitchUp","pitchDown","yawLeft","yawRight"].forEach(function(t){i.createThruster(t,"rotation",s)}),this.lastState=null};return p.getActionNames=function(){return o.slice(0)},p.prototype.createThruster=function(t,e,o){var a=this.agility[e],s=new r(this.timeWatch,a.time),c=function(t){return n.bezierGetY(o,t)},u=new i(s,a.maximum,c);this.thrusters[t]=u},p.prototype.getShotList=function(){return this.shotList},p.prototype.setCommandChannel=function(t){this.commandChannel=t},p.prototype.setChaseObject=function(t){this.chaseObject=t,this.chaseObject||this.resetToRecording()},p.prototype.resetToRecording=function(){var t=this.camera,e=t.getStateData(this.lastState),r=this.shotList.getFrameData()||e;t.setStateData(r)},p.prototype.placeObjectInFrontOfCamera=function(e,r){var i=e.getStateData(),n=this.camera.getStateData(),o=r>10?r:10;c(n.rotation,i.rotation),i.position=[0,0,o],t.quat4.multiplyVec3(i.rotation,i.position),t.vec3.subtract(i.position,n.position),e.setStateData(i)},p.prototype.updateCamera=function(){var t=this.camera,e=t.getStateData(this.lastState),r=t.getStateData(),i=this.shotList.getFrameData()||r;r=this.chaseObject?this.updateByChase(r,e):this.commandChannel?this.updateByCommands(r,e,i):i,t.setStateData(r),this.shotList.setFrameData(r),this.lastState=e},p.prototype.updateByChase=function(r,i){var n=this.chaseObject.getStateData(),o=this.chaseObject.getBoundingSphereRadius(),a=-10-2*o;return t.vec3.negate(n.position,r.position),t.quat4.set(n.rotation,r.rotation),t.quat4.inverse(r.rotation),s(r.rotation,0,e.degreeToRad(-1)*e.VIEW_ROTATION_PITCH_UP,Math.PI),t.vec3.set([0,.5*-o,a],r.viewOffset),r},p.prototype.updateByCommands=function(t,r,i){var n=this.timeWatch.getDelta(),o=this.commandChannel.getCommands(),c=(this.thrusters.rollClockwise.getSpeed(o.rollClockwise)-this.thrusters.rollCounter.getSpeed(o.rollCounter))*n,p=(this.thrusters.pitchUp.getSpeed(o.pitchUp)-this.thrusters.pitchDown.getSpeed(o.pitchDown))*n,h=(this.thrusters.yawRight.getSpeed(o.yawRight)-this.thrusters.yawLeft.getSpeed(o.yawLeft))*n,l=(this.thrusters.moveUp.getSpeed(o.moveUp)-this.thrusters.moveDown.getSpeed(o.moveDown))*n,d=(this.thrusters.moveRight.getSpeed(o.moveRight)-this.thrusters.moveLeft.getSpeed(o.moveLeft))*n,f=(this.thrusters.moveForward.getSpeed(o.moveForward)-this.thrusters.moveBackward.getSpeed(o.moveBackward))*n;return s(t.rotation,c,p,h),a[0]=d*e.VIEW_DIRECTION_RIGHT,a[1]=l*e.VIEW_DIRECTION_UP,a[2]=f*e.VIEW_DIRECTION_FORWARD,u(t.rotation,a),t.position[0]+=a[0],t.position[1]+=a[1],t.position[2]+=a[2],t.viewOffset[0]=t.viewOffset[1]=t.viewOffset[2]=0,t},p}),define("production/Resources",["production/StageManager","production/Director","production/CameraOperator"],function(t,e,r){"use strict";var i={StageManager:t,Director:e,CameraOperator:r};return i}),define("controls/Gamepad",["lib/gamepad"],function(t){"use strict";var e=function(t){this.listeners=[]};return e.prototype.getRuntimeId=function(){return this.runtimeId},e.prototype.addListener=function(t){this.listeners.push(t)},e.prototype.onDeviceDisconnected=function(){this.listeners.forEach(function(t){t.onGamepadDisconnected()})},e.prototype.onControlValueChanged=function(t,e){this.listeners.forEach(function(r){r.onControlValueChanged(t,e)})},e}),define("controls/GamepadApi",["lib/gamepad","controls/Gamepad"],function(t,e){"use strict";var r=function(){this.lib=new t,this.gamepads={},this.idCounter=0,this.connectionListeners=[]};return r.prototype.init=function(){var e=this;return this.lib.bind(t.Event.CONNECTED,function(t){e.onDeviceConnected(t)}),this.lib.bind(t.Event.DISCONNECTED,function(t){e.onDeviceDisonnected(t)}),this.lib.bind(t.Event.BUTTON_DOWN,function(t){e.onControlValueChanged(t.gamepad.index,t.control,1)}),this.lib.bind(t.Event.BUTTON_UP,function(t){e.onControlValueChanged(t.gamepad.index,t.control,0)}),this.lib.bind(t.Event.AXIS_CHANGED,function(t){e.onAxisValueChanged(t.gamepad.index,t.axis,t.value)}),this.lib.init()},r.prototype.getGamepads=function(){var t,e=[];for(t in this.gamepads)e.push(this.gamepads[t]);return e},r.prototype.addGamepadListener=function(t){this.connectionListeners.push(t)},r.prototype.onDeviceConnected=function(t){var r=new e(this.idCounter++);this.gamepads[t.index]=r,this.connectionListeners.forEach(function(t){t.onGamepadConnected(r)})},r.prototype.onDeviceDisonnected=function(t){var e=this.gamepads[t.index];e&&(delete this.gamepads[t.index],e.onDeviceDisconnected(),this.connectionListeners.forEach(function(t){t.onGamepadDisconnected(e)}))},r.prototype.onControlValueChanged=function(t,e,r){var i=this.gamepads[t];i&&i.onControlValueChanged(e,r)},r.prototype.onAxisValueChanged=function(t,e,r){var i=this.gamepads[t];i&&(0>r?(i.onControlValueChanged(e+"_POS",0),i.onControlValueChanged(e+"_NEG",-r)):(i.onControlValueChanged(e+"_NEG",0),i.onControlValueChanged(e+"_POS",r)))},r}),define("production/ccp/res/Ship",["lib/gl-matrix"],function(t){"use strict";var e=function(e,r,i,n){this.ccpwgl=e,this.obj=r,this.id=i,this.propData=n,this.position=t.vec3.create(),this.rotation=t.quat4.identity(),this.transform=t.mat4.identity()};return e.prototype.toString=function(){return"Ship "+this.id},e.prototype.getBoundingSphereRadius=function(){return this.obj.getBoundingSphere()[1]},e.prototype.getStateData=function(e){var r=e||{};return r.position=t.vec3.set(this.position,r.position||[0,0,0]),r.rotation=t.quat4.set(this.rotation,r.rotation||[0,0,0,1]),r},e.prototype.setStateData=function(e){t.vec3.set(e.position,this.position),t.quat4.set(e.rotation,this.rotation),t.mat4.fromRotationTranslation(this.rotation,this.position,this.transform),this.obj.setTransform(this.transform)},e}),define("production/ccp/res/ShipArchetype",["production/ccp/res/Ship"],function(t){"use strict";var e=function(t){this.propData=t||{},this.propData.propType=e.propType};return e.propType="ship",e.prototype.request=function(e,r,i,n){var o=this.propData;return r.loadShip(this.propData.resourceUrl,function(){i.resolve(new t(e,this,n,o))})},e.prototype.setResourceUrl=function(t){return this.propData.resourceUrl=t,this},e}),define("production/ccp/res/Planet",["lib/gl-matrix"],function(t){"use strict";var e=function(e,r,i){this.obj=e,this.id=r,this.propData=i,this.position=t.vec3.create(),this.rotation=t.quat4.identity(),this.transform=t.mat4.identity(),this.radius=6e4};return e.prototype.toString=function(){return"Planet "+this.id},e.prototype.getBoundingSphereRadius=function(){return this.radius},e.prototype.getStateData=function(e){var r=e||{};return r.position=t.vec3.set(this.position,r.position||[0,0,0]),r.rotation=t.quat4.set(this.rotation,r.rotation||[0,0,0,1]),r},e.prototype.setStateData=function(e){t.vec3.set(e.position,this.position),t.quat4.set(e.rotation,this.rotation),t.mat4.fromRotationTranslation(this.rotation,[0,0,0],this.transform),t.mat4.scale(this.transform,[this.radius/2,this.radius/2,this.radius/2]),this.transform[12]=this.position[0],this.transform[13]=this.position[1],this.transform[14]=this.position[2],this.obj.setTransform(this.transform)},e}),define("production/ccp/res/PlanetArchetype",["production/ccp/res/Planet"],function(t){"use strict";var e=function(t){this.propData=t};return e.propType="planet",e.prototype.request=function(e,r,i,n){var o=this.propData,a=r.loadPlanet(this.propData.itemId,this.propData.resourceUrl,this.propData.atmosphereUrl,this.propData.heightMap1Url,this.propData.heightMap2Url);i.resolve(new t(a,n,o))},e.prototype.setItemId=function(t){return this.propData.itemId=t,this},e.prototype.setResourceUrl=function(t){return this.propData.resourceUrl=t,this},e.prototype.setAtmosphereUrl=function(t){return this.propData.atmosphereUrl=t,this},e.prototype.setHeightMap1Url=function(t){return this.propData.heightMap1Url=t,this},e.prototype.setHeightMap2Url=function(t){return this.propData.heightMap2Url=t,this},e}),define("production/ccp/res/Scenery",["lib/gl-matrix"],function(t){"use strict";var e=function(e,r,i,n){this.ccpwgl=e,this.obj=r,this.id=i,this.propData=n,this.position=t.vec3.create(),this.rotation=t.quat4.identity(),this.transform=t.mat4.identity()};return e.prototype.toString=function(){return"Scenery "+this.id},e.prototype.getBoundingSphereRadius=function(){return this.obj.getBoundingSphere()[1]},e.prototype.getStateData=function(e){var r=e||{};return r.position=t.vec3.set(this.position,r.position||[0,0,0]),r.rotation=t.quat4.set(this.rotation,r.rotation||[0,0,0,1]),r},e.prototype.setStateData=function(e){t.vec3.set(e.position,this.position),t.quat4.set(e.rotation,this.rotation),t.mat4.fromRotationTranslation(this.rotation,this.position,this.transform),this.obj.setTransform(this.transform)},e}),define("production/ccp/res/SceneryArchetype",["production/ccp/res/Scenery"],function(t){"use strict";var e=function(t){this.propData=t||{},this.propData.propType=e.propType};return e.propType="scenery",e.prototype.request=function(e,r,i,n){var o=this.propData;return r.loadObject(this.propData.resourceUrl,function(){i.resolve(new t(e,this,n,o))})},e.prototype.setResourceUrl=function(t){return this.propData.resourceUrl=t,this},e}),define("production/Track",[],function(){"use strict";var t=function(t){this.data=t,this.currentFrame=0};return t.prototype.getLength=function(){return this.data.length},t.prototype.setCurrentFrame=function(t){this.currentFrame=t},t.prototype.getFrameData=function(){var t=null,e=this.data.length;return e>0&&(t=e>this.currentFrame?this.data[this.currentFrame]:this.data[e-1]),t},t.prototype.setRecording=function(t){this.recording=t},t.prototype.setFrameData=function(t){var e=this.data.length;this.recording&&(e<this.currentFrame&&(e>0?this.pushFrameUntilCurrentIndex(this.data[e-1]):this.pushFrameUntilCurrentIndex(t)),this.data[this.currentFrame]=t)},t.prototype.pushFrameUntilCurrentIndex=function(t){for(var e=this.data.length;e<this.currentFrame;)this.data.push(t),e++},t}),define("production/Reel",[],function(){"use strict";var t=function(){this.tracks=[],this.currentFrame=0};return t.prototype.getPosition=function(){return this.currentFrame},t.prototype.getLength=function(){var t=0;return this.tracks.forEach(function(e){var r=e.getLength();r>t&&(t=r)}),t},t.prototype.addTrack=function(t){this.tracks.push(t),t.setCurrentFrame(this.currentFrame)},t.prototype.skipTo=function(t){this.currentFrame=t,this.tracks.forEach(function(e){e.setCurrentFrame(t)})},t.prototype.nextFrame=function(){this.skipTo(this.currentFrame+1)},t}),define("util/BrowserHelper",[],function(){"use strict";var t=function(t,e,r,i){var n=["webkit","moz","ms","o"],o=function(){return r};return n.forEach(function(r){var n=i&&i[r]||r+e;n in t&&(o=function(){return t[n]})}),o},e={findPrefixProperty:t};return e}),define("util/time/SystemTimeSource",["util/BrowserHelper"],function(t){"use strict";var e=window.performance||{};"now"in e||(e.now=t.findPrefixProperty(e,"Now",function(){return(new Date).getTime()})());var r=function(){this.startTime=e.now()};return r.prototype.now=function(){return.001*(e.now()-this.startTime)},r}),define("util/time/ClockedTimeSource",[],function(){"use strict";var t=function(t){this.hertz=t,this.delta=1/t,this.time=0};return t.prototype.tick=function(){this.time+=this.delta},t.prototype.setTickCount=function(t){this.time=t/this.hertz},t.prototype.now=function(){return this.time},t}),define("util/time/TimeWatch",[],function(){"use strict";var t=function(t){this.reset(t||0)};return t.prototype.reset=function(t){this.lastTime=t,this.delta=0},t.prototype.setTime=function(t){this.delta=t-this.lastTime,this.lastTime=t},t.prototype.getDelta=function(){return this.delta},t}),define("ApplicationController",["lib/q","Defaults","ui/Dialogs","production/Resources","controls/GamepadApi","production/ccp/res/ShipArchetype","production/ccp/res/PlanetArchetype","production/ccp/res/SceneryArchetype","production/Track","production/Reel","util/time/SystemTimeSource","util/time/ClockedTimeSource","util/time/TimeWatch"],function(t,e,r,i,n,o,a,s,c,u,p,h,l){"use strict";var d=function(t,e,r,i,n,o){var s=new a({propType:a.propType});s.setItemId(e),s.setResourceUrl(r),s.setAtmosphereUrl(i),s.setHeightMap1Url(n),s.setHeightMap2Url(o),t.addResource("planet",s)},f=function(t,e,r){t.status="Initializing...",t.record=function(){e.record()},t.stop=function(){e.stop()},t.play=function(){e.play()},t.newProp=function(){e.newProp()},t.setFocusOnCamera=function(){e.setFocusOnCamera()},t.setFocusOnProp=function(t){e.setFocusOnProp(t)},t.encodeSession=function(){return e.encodeSession()},t.starLightColorChanged=function(){e.setStarLightColor(t.set.lighting.starLightColor)},t.requestStar=function(t){e.requestStar(t)},t.set={lighting:{starLightColor:[0,0,0]}},t.stars=[];var i={resourceUrl:"",toString:function(){return"(no star)"}};t.stars.push(i),t.selectedStar=i,t.stageProps=[]},m=function(t,e,r,i,n){var o=this,a={set:{}};this.systemTimeSource=new p,this.timeWatch=new l,this.mainScreen=n,this.productionManager=i,this.modelView=t,this.dialogFactory=e,this.sessionMeta=a,f(t,this,r);var s=i.setResourcePath("res","//web.ccpgamescdn.com/ccpwgl/res/");s.then(function(e){o.resourceLibrary=e,e.forEachResource("star",function(t){o.modelView.stars.push(t)}),d(e,40000002,"res:/dx9/model/WorldObject/Planet/Template/Terrestrial/P_Terrestrial_61.red",void 0,"res:/dx9/model/worldobject/planet/Terrestrial/Terrestrial03_H.png","res:/dx9/model/worldobject/planet/Terrestrial/Terrestrial04_H.png"),d(e,40000100,"res:/dx9/model/WorldObject/Planet/Template/Gas/P_GasGiant_12.red",void 0,"res:/dx9/model/worldobject/planet/Gasgiant/GasGiant01_D.png","res:/dx9/model/worldobject/planet/Gasgiant/GasGiant03_D.png"),t.$apply(function(){o.showCreationDialog(e)})})};m.prototype.showCreationDialog=function(e){var i=this.productionManager,n=this.mainScreen,o=this.sessionMeta,a=this.modelView,s=this,c=function(e,r){var i=t.defer(),n={set:null,data:r};return e.then(function(t){n.set=t,i.resolve(n)},function(t){i.reject(t)}),i.promise},u={setQualityOptions:function(t){i.setQualityOptions(t)},createSpaceSet:function(t,e){var r=i.createSet(n,t.resourceUrl);return o.set={space:{background:t.resourceUrl}},c(r,e)},createChromaKeyedSet:function(t,e){var r=i.createChromaKeyedSet(n,t);return o.set={chromaKey:{color:t}},c(r,e)}},p={backgrounds:[],qualityOptions:i.getQualityOptions()};e.forEachResource("sceneBg",function(t){p.backgrounds.push(t)}),p.backgrounds.sort(function(t,e){return t.toString().localeCompare(e.toString())});var h=r.createSessionDialog.getBuilder(s.dialogFactory,p),l=null;h.open().then(function(t){return l=s.showSplash("Creating set...","Please wait."),t(u)}).then(function(t){l.close(),l=null,s.onSessionCreated(t),a.status="Set created",
a.$apply()},function(t){var e=t&&(t.message||t)||"Unknown reason. That's bad.";l.close(),l=null,s.showSplash("Failed to create a set. Try Reloading.",e)})},m.prototype.showSplash=function(t,e){var i={title:t,message:e},n=r.splashDialog.getBuilder(this.dialogFactory,i);n.open();return this.modelView.$$phase||this.modelView.$apply(),n},m.prototype.encodeSession=function(){var t={ver:0,session:this.sessionMeta,stage:this.stageManager.encodeData(),videography:{cameras:[{shotList:this.cameraOperator.getShotList().data}]},lighting:this.set.getLightBoard().getStateData()};return JSON.stringify(t)},m.prototype.newProp=function(){var t=this,e={resLibrary:this.resourceLibrary},i=r.addPropDialog.getBuilder(this.dialogFactory,e);i.open().then(function(e){e(t)})},m.prototype.addProp=function(t,e){var r=this,i=this.set.getStage().enter(t);i.then(function(t){var i=t.getBoundingSphereRadius();r.createScriptedAnimatorForProp(t,e),e||(r.cameraOperator.placeObjectInFrontOfCamera(t,i),r.setFocusOnProp(t)),r.modelView.stageProps.push(t),r.modelView.$apply()})},m.prototype.createScriptedAnimatorForProp=function(t,e){var r=new c(e||[]),i=this.stageManager.getAnimator(t);i.setScript(r),this.reel.addTrack(r)},m.prototype.createDefaultBindings=function(){for(var t in e.inputsByAction)this.director.addBinding({actionName:t},{inputName:e.inputsByAction[t]})},m.prototype.setupGamepadInput=function(){var t=this.director.getInputChannel("gamepad"),e={onGamepadDisconnected:function(){},onControlValueChanged:function(e,r){t.setIntensity(e,r)}},r=new n;r.addGamepadListener({onGamepadConnected:function(t){t.addListener(e)},onGamepadDisconnected:function(){}}),r.init()},m.prototype.findStarDescByResourceUrl=function(t){var e=null;return this.modelView.stars.forEach(function(r){r.resourceUrl===t&&(e=r)}),e},m.prototype.onSessionCreated=function(t){var e=this,r=t.set,n=r.getLightBoard();this.set=r,this.clockedTimeSource=new h(this.set.getSyncSource().getRate()),this.timeWatch.reset(e.clockedTimeSource.now()),this.director=new i.Director,this.reel=new u,this.stopReelTransmission(),this.camCommands=this.director.getCommandChannel("camera",i.CameraOperator.getActionNames());var o=null;t.data&&t.data.lighting&&(this.modelView.set.lighting.starLightColor=t.data.lighting.starLightColor,n.setStarLightColor(t.data.lighting.starLightColor),""!==t.data.lighting.starResourceUrl&&(this.modelView.selectedStar=this.findStarDescByResourceUrl(t.data.lighting.starResourceUrl),n.requestStar(t.data.lighting.starResourceUrl))),t.data&&t.data.videography&&t.data.videography.cameras.forEach(function(t){var r=new c(t.shotList);e.reel.addTrack(r),o||(o=r)}),o||(o=new c([]),this.reel.addTrack(o)),this.cameraOperator=new i.CameraOperator(r.getSceneCamera(),o,this.timeWatch),this.setFocusOnCamera(),this.stageManager=new i.StageManager(r.getStage(),this.timeWatch),this.createDefaultBindings(),this.setupGamepadInput(),t.data&&t.data.stage.props.forEach(function(t){var r=e.productionManager.getArchetypeForProp(t.propData);e.addProp(r,t.script)}),this.animCommands=e.director.getCommandChannel("animator",i.CameraOperator.getActionNames()),r.getSyncSource().setCallback(function(){e.clockedTimeSource.tick(),e.timeWatch.setTime(e.clockedTimeSource.now()),e.stageManager.updateStage(),e.cameraOperator.updateCamera(),e.reelTransmission.update()})},m.prototype.setStarLightColor=function(t){var e=this.set.getLightBoard();e.setStarLightColor(t)},m.prototype.requestStar=function(t){var e=this.set.getLightBoard();""!==t.resourceUrl?e.requestStar(t.resourceUrl):e.removeStar()},m.prototype.clearFocus=function(){this.focusTarget&&(this.focusTarget.setCommandChannel(null),this.focusTarget=null,this.focusTrack.setRecording(!1),this.focusTrack=null,this.focusCommandChannel=null,this.modelView.selectedFocus=null,this.modelView.$apply())},m.prototype.setFocusOnCamera=function(){this.clearFocus(),this.focusTarget=this.cameraOperator,this.focusTrack=this.cameraOperator.getShotList(),this.focusCommandChannel=this.camCommands,this.cameraOperator.setChaseObject(null),this.focusTarget.setCommandChannel(this.focusCommandChannel)},m.prototype.setFocusOnProp=function(t){this.clearFocus(),this.focusTarget=this.stageManager.getAnimator(t),this.focusTrack=this.focusTarget.getScript(),this.focusCommandChannel=this.animCommands,this.cameraOperator.setChaseObject(t),this.focusTarget.setCommandChannel(this.focusCommandChannel),this.modelView.selectedFocus=t,this.modelView.$apply()},m.prototype.record=function(){this.startReelTransmission(),this.reel.skipTo(0),this.focusTarget&&(this.focusTarget.setCommandChannel(this.focusCommandChannel),this.focusTrack.setRecording(!0))},m.prototype.stop=function(){this.stopReelTransmission(),this.reel.skipTo(0),this.focusTarget&&(this.focusTarget.resetToRecording(),this.focusTarget.setCommandChannel(this.focusCommandChannel),this.focusTrack.setRecording(!1))},m.prototype.play=function(){this.startReelTransmission(),this.reel.skipTo(0),this.focusTarget&&(this.focusTarget.setCommandChannel(null),this.focusTrack.setRecording(!1))},m.prototype.startReelTransmission=function(){var t=this.reel;this.reelTransmission={update:function(){t.nextFrame()}}},m.prototype.stopReelTransmission=function(){this.reelTransmission={update:function(){}}};var g=function(t,e,r){return function(i,n){return new m(i,n,t,e,r)}};return{ApplicationController:m,create:g}}),define("production/ccp/SyncSource",[],function(){"use strict";var t=60,e=function(t,e){this.ccpwgl=t,this.scene=e};return e.prototype.setCallback=function(t){this.ccpwgl.onPostRender=t},e.prototype.getRate=function(){return t},e}),define("production/ccp/Set",[],function(){"use strict";var t=function(t){this.ccpwgl=t.ccpwgl,this.scene=t.scene,this.syncSource=t.syncSource,this.stage=t.stage,this.sceneCamera=t.sceneCamera,this.lightBoard=t.lightBoard};return t.prototype.getSyncSource=function(){return this.syncSource},t.prototype.getStage=function(){return this.stage},t.prototype.getSceneCamera=function(){return this.sceneCamera},t.prototype.getLightBoard=function(){return this.lightBoard},t}),define("production/ccp/Stage",["lib/q"],function(t){"use strict";var e=function(t,e){this.ccpwgl=t,this.scene=e,this.propCounter=1,this.props=[]};return e.prototype.forEachProp=function(t){this.props.forEach(t)},e.prototype.enter=function(e){var r=t.defer(),i=this;return e.request(this.ccpwgl,this.scene,r,this.propCounter++),r.promise.then(function(t){i.props.push(t)}),r.promise},e.prototype.getProps=function(){return this.props},e}),define("production/ccp/SceneCamera",["lib/gl-matrix","util/GlHelper"],function(t,e){"use strict";var r=function(){this.fov=60,this.nearPlane=1,this.farPlane=1e5,this.rotation=t.quat4.identity(),this.position=t.vec3.create(),this.viewOffset=t.vec3.create(),this.projection=t.mat4.create(),this.view=t.mat4.create(),this.updateView=this.calculateView};return r.prototype.nullFunction=function(){},r.prototype.calculateView=function(){t.mat4.fromRotationTranslation(this.rotation,this.viewOffset,this.view),t.mat4.translate(this.view,this.position),this.updateView=this.nullFunction},r.prototype.onViewChanged=function(){this.updateView=this.calculateView},r.prototype.getProjection=function(e){return t.mat4.perspective(this.fov,e,this.nearPlane,this.farPlane,this.projection),this.projection},r.prototype.getView=function(){return this.updateView(),this.view},r.prototype.update=function(t){},r.prototype.getStateData=function(t){var e=t||{};return e.viewOffset=this.getViewOffset(e.viewOffset),e.position=this.getPosition(e.position),e.rotation=this.getRotation(e.rotation),e},r.prototype.setStateData=function(e){t.vec3.set(e.viewOffset,this.viewOffset),t.vec3.set(e.position,this.position),t.quat4.set(e.rotation,this.rotation),this.onViewChanged()},r.prototype.getViewOffset=function(e){return t.vec3.set(this.viewOffset,e||[0,0,0])},r.prototype.getPosition=function(e){return t.vec3.set(this.position,e||[0,0,0])},r.prototype.setPosition=function(e){t.vec3.set(e,this.position),this.onViewChanged()},r.prototype.getRotation=function(e){return t.quat4.set(this.rotation,e||[0,0,0,0])},r.prototype.setRotation=function(e){t.quat4.set(e,this.rotation),this.onViewChanged()},r}),define("production/ccp/LightBoard",["lib/q"],function(t){"use strict";var e=function(){this.context=null};e.prototype.activate=function(t){this.context=t},e.prototype.request=function(t,e){this.context.activateSunState(new i(t,e))},e.prototype.remove=function(){this.context.activateSunState(new r)};var r=function(){};r.prototype.activate=function(t){t.scene.removeSun(),t.activateSunState(new n)};var i=function(t,r){this.context=null,this.resourceUrl=r,this.deferred=t,this.nextState=new e};i.prototype.activate=function(t){var e=this;t.scene.loadSun(this.resourceUrl,function(){t.stateData.starResourceUrl=e.resourceUrl,t.activateSunState(e.nextState),e.deferred.resolve()})},i.prototype.request=function(t,e){this.nextState=new i(t,e)},i.prototype.remove=function(){this.nextState=new r};var n=function(){this.context=null};n.prototype.activate=function(t){this.context=t},n.prototype.request=function(t,e){return this.context.activateSunState(new i(t,e))},n.prototype.remove=function(){};var o=function(t,e){this.ccpwgl=t,this.scene=e,this.stateData={starLightColor:[0,0,0],starResourceUrl:""},this.setStarLightColor(this.stateData.starLightColor),this.activateSunState(new n)};return o.prototype.getStateData=function(){return this.stateData},o.prototype.activateSunState=function(t){this.sunState=t,t.activate(this)},o.prototype.setStarLightColor=function(t){this.stateData.starLightColor=t||[0,0,0],this.scene.setSunLightColor(this.stateData.starLightColor)},o.prototype.requestStar=function(e){var r=t.defer();return this.sunState.request(r,e),r.promise},o.prototype.removeStar=function(){this.sunState.remove()},o.SunStates={Unloaded:n,Loading:i,Loaded:e,Unloading:r},o}),define("production/ccp/res/ArchetypeList",["production/ccp/res/PlanetArchetype","production/ccp/res/SceneryArchetype","production/ccp/res/ShipArchetype"],function(){"use strict";var t,e=[];for(t=0;t<arguments.length;t++)e.push(arguments[t]);return e}),define("production/ResourceLibrary",[],function(){"use strict";var t=function(t){this.namespace=t,this.resources={}};return t.prototype.getNamespace=function(){return this.namespace},t.prototype.addResource=function(t,e){var r=this.resources[t];r||(this.resources[t]=r=[]),r.push(e)},t.prototype.forEachResource=function(t,e){t in this.resources&&this.resources[t].forEach(e)},t}),define("production/ccp/ProductionManager",["lib/q","production/ccp/SyncSource","production/ccp/Set","production/ccp/Stage","production/ccp/SceneCamera","production/ccp/LightBoard","production/ccp/res/ArchetypeList","production/ResourceLibrary","lib/ccpStandardGraphicIds"],function(t,e,r,i,n,o,a,s,c){"use strict";var u={},p=null;a.forEach(function(t){u[t.propType]=t});var h=function(t){var e,r;for(e in c)r=c[e],r.graphicFile&&t(parseInt(e,10),r)},l={},d=function(t,a){var s={ccpwgl:t,scene:a,syncSource:new e(t,a),stage:new i(t,a),sceneCamera:new n,lightBoard:new o(t,a)};return t.setCamera(s.sceneCamera),new r(s)},f=function(e,r,i){var n=t.defer(),o=function(t){var r=d(e,t);n.resolve(r)};try{e.initialize(r,l),i(o)}catch(a){n.reject(a)}return n.promise},m=function(t){this.ccpwgl=t};m.STANDARD_RES_NAMESPACE="res",m.STANDARD_RES_URL="//web.ccpgamescdn.com/ccpwgl/res/";var g=/.*\/scene\/.*red$/i,v=/.*\/model\/ship\/.*red$/i,y=/.*wreck.*/i,C=/.*\/planet\/.*red$/i,S=/.*\/model\/lensflare\/.*red$/i,w=/.*\/model\/turret\/.*red$/i,T=/.*red$/i,D=/.*(character|interior|placeable).*/i,b=function(t){return g.test(t.graphicFile)},R=function(t){return v.test(t.graphicFile)&&!y.test(t.graphicFile)},O=function(t){return C.test(t.graphicFile)},I=function(t){return S.test(t.graphicFile)},E=function(t){return w.test(t.graphicFile)},_=function(t){return T.test(t.graphicFile)&&!D.test(t.graphicFile)},L=function(){var t={toString:function(){return this.resourceUrl}};return function(e){var r=Object.create(t);return r.resourceUrl=e.graphicFile,r}}(),A=function(){var t={toString:function(){return this.resourceUrl}};return function(e){var r=Object.create(t);return r.resourceUrl=e.graphicFile,r}}(),F=function(t){var e=u.ship,r={resourceUrl:t.graphicFile};return new e(r,t.description)},U=function(t){var e=u.scenery,r={resourceUrl:t.graphicFile};return new e(r,t.description)};return m.getStandardResourceLibrary=function(){return p||(p=new s(m.STANDARD_RES_NAMESPACE),h(function(t,e){b(e)?p.addResource("sceneBg",L(e)):R(e)?p.addResource("ship",F(e)):O(e)||(I(e)?p.addResource("star",A(e)):E(e)||_(e)&&p.addResource("scenery",U(e)))})),p},m.prototype.getQualityOptions=function(){var t=[],e=function(t,e){var r={title:t,id:e};return r};return t.push({title:"Shader Quality",field:"shaderQuality",defaultValue:this.ccpwgl.ShaderQuality.HIGH,values:[e("High",this.ccpwgl.ShaderQuality.HIGH),e("Low",this.ccpwgl.ShaderQuality.LOW)]}),t.push({title:"Anisotropic Filter",field:"anisotropicFilter",defaultValue:!0,values:[e("Yes",!0),e("No",!1)]}),t.push({title:"Postprocessing",field:"postprocessing",defaultValue:!1,values:[e("Yes",!0),e("No",!1)]}),t},m.prototype.setQualityOptions=function(t){var e;for(e in t)l[e]=t[e]},m.prototype.setResourcePath=function(e,r){var i=t.defer();return this.ccpwgl.setResourcePath(e,r),e===m.STANDARD_RES_NAMESPACE?i.resolve(m.getStandardResourceLibrary()):i.reject("Not supported"),i.promise},m.prototype.createSet=function(t,e){var r=this.ccpwgl;return f(r,t,function(t){var i=function(){t(this)};r.loadScene(e,i)})},m.prototype.createChromaKeyedSet=function(t,e){var r=this.ccpwgl;return f(r,t,function(t){var i=r.createScene(e);t(i)})},m.prototype.getArchetypeForProp=function(t){var e=u[t.propType],r=null;return e&&(r=new e(t)),r},m}),define("services/FileReaderService",[],function(){"use strict";var t=function(t){var e=function(t,e,r){return function(){t.$apply(function(){e.resolve(r.result)})}},r=function(t,e,r){return function(){t.$apply(function(){e.reject(r.result)})}},i=function(t,i){var n=new FileReader;return n.onload=e(t,i,n),n.onerror=r(t,i,n),n},n=function(e,r,n){var o=t.defer(),a=i(e,o);return a.readAsText(r,n),o.promise};return{readAsText:n}},e=function(e,r){r.factory("fileReader",["$q",t])},r={register:e};return r}),define("services/ServiceList",["services/FileReaderService"],function(){"use strict";var t,e=[];for(t=0;t<arguments.length;t++)e.push(arguments[t]);return e}),define("ui/ControllerList",["ui/SplashDialog","ui/CreateSessionDialog","ui/AddPropDialog"],function(){"use strict";var t,e=[];for(t=0;t<arguments.length;t++)e.push(arguments[t]);return e}),define("directives/FilmViewDirective",["util/BrowserHelper"],function(t){"use strict";var e=function(e,r){var i=e.document,n=function(){return i.fullScreen};"fullScreen"in i||(n=t.findPrefixProperty(i,"FullScreen",!1,{webkit:"webkitIsFullScreen"}));var o=n();e.setInterval(function(){var t=n();t!==o&&(o=t,r())},100)},r=function(r,i){i.directive("filmView",function(i){return function(n,o){var a=o[0],s=r.element(i),c=16/9,u=function(t){n.style=function(){var e=(t.width/c).toFixed(0),r=0;return t.height>e&&(r=((t.height-e)/2).toFixed(0)),{position:"relative",top:r+"px",width:t.width+"px",height:e+"px"}}};n.getAreaDimension=function(){return{width:a.clientWidth,height:a.clientHeight}},n.goFullscreen=function(){a.requestFullScreen||(a.requestFullScreen=t.findPrefixProperty(a,"RequestFullScreen",function(){})()),a.requestFullScreen()},n.$watch(n.getAreaDimension,function(t,e){u(t)},!0),s.bind("resize",function(){n.$$phase||n.$apply()}),e(i,function(){n.$apply()})}})},i={register:r};return i}),define("directives/SaveAsDirective",["util/BrowserHelper"],function(t){"use strict";var e=function(e,r){r.directive("saveAs",function(e){return function(r,i,n){var o=i[0],a=e.URL;a||(a=t.findPrefixProperty(e,"URL",{createObjectURL:function(){return"#"}})),o.target="_blank",o.download="session.json",i.bind("click",function(t){o.href="#"}),i.bind("click",function(){var t=r.encodeSession(),e=new Blob([t],{type:"application/json;charset=utf-8"});o.href=a.createObjectURL(e)})}})},r={register:e};return r}),define("directives/FileInputDirective",[],function(){"use strict";var t=function(t,e){e.directive("fileInput",function(t){return{restrict:"EA",template:'<input type="file" />',replace:!0,link:function(e,r,i){var n=t(i.fileInput||i.dataFileInput),o=n.assign,a=t(i.onChange),s=function(){e.$apply(function(){o(e,r[0].files[0]),a(e)})};r.bind("change",s)}}})},e={register:t};return e}),define("directives/ColorInputDirective",[],function(){"use strict";var t=function(t){var e=(255*t).toFixed(0),r=parseInt(e,10);return("0"+r.toString(16)).substr(-2)},e={"^#([0-9A-Fa-f]){6}$":function(t){var e=parseInt(t.substr(1,2),16),r=parseInt(t.substr(3,2),16),i=parseInt(t.substr(5,2),16);return[e/255,r/255,i/255]}},r=function(t,r){var i,n;for(i in e)n=new RegExp(i),n.test(t)&&r(e[i])},i=function(t){var e=null;return r(t,function(r){e=r(t)}),e},n=function(e,r){r.directive("colorInput",function(e){return{restrict:"EA",template:"<div class='row-fluid'><div class='span4 container'><input class='span12' type='text' ng-model='colorText' placeholder='#0044BB' ng-change='colorChanged()'></input></div><div class='offset4 span4 container' ng-style='{ backgroundColor: colorText }'></div></div>",replace:!0,link:function(r,n,o){var a=e(o.color||o.dataColor),s=a.assign,c=e(o.onChange);r.$watch(o.color,function(e){e&&(r.colorText="#"+t(e[0])+t(e[1])+t(e[2]))}),r.colorChanged=function(){var t=i(r.colorText);s(r,t),c(r)}}}})},o={register:n};return o}),define("directives/DirectiveList",["directives/FilmViewDirective","directives/SaveAsDirective","directives/FileInputDirective","directives/ColorInputDirective"],function(){"use strict";var t,e=[];for(t=0;t<arguments.length;t++)e.push(arguments[t]);return e}),define("ClientApp",["module","angular","lib/ccpwgl","ApplicationController","production/ccp/ProductionManager","services/ServiceList","ui/ControllerList","directives/DirectiveList"],function(t,e,r,i,n,o,a,s){"use strict";var c=t.config(),u=function(t){var u=e.module("ClientApp",["ui.bootstrap"]),p=new n(r);return u.controller("ApplicationController",["$scope","$dialog",i.create(c,p,t)]),o.forEach(function(t){t.register(e,u)}),s.forEach(function(t){t.register(e,u)}),a.forEach(function(t){t.register(u)}),[u.name]};return u});